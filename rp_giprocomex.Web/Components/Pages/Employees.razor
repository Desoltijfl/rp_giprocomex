@page "/employees"
@inject EmployeeService EmployeeService
@using rp_giprocomex.Core.Models

<h3>Empleados</h3>

<input @bind="search" placeholder="Buscar..." class="form-control mb-2" />
<button class="btn btn-primary mb-3" @onclick="Load">Buscar</button>

<table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Puesto</th>
            <th>Oficina</th>
            <th>Empresa</th>
            <th>Registro</th>
            <th>Nombre</th>
            <th>Ingreso</th>
            <th>Aniv.</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var e in employees)
        {
            <tr>
                <td>@e.Numero</td>
                <td>@e.Puesto</td>
                <td>@e.Oficina</td>
                <td>@e.Empresa</td>
                <td>@e.RegistroPatronal</td>
                <td>@e.NombreCompleto</td>
                <td>@e.FechaIngreso.ToString("dd-MM-yyyy")</td>
                <td>@e.Aniversario</td>
                <td>
                    <a class="btn btn-sm btn-secondary" href="@($"employees/edit/{e.Id}")">Editar</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@code {
    private List<Employee> employees = new();
    private string? search;

    protected override async Task OnInitializedAsync() => await Load();

    private async Task Load()
    {
        employees = string.IsNullOrWhiteSpace(search)
            ? await EmployeeService.GetAllAsync()
            : await EmployeeService.SearchAsync(search);
    }
}