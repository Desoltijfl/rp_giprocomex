@page "/employees/edit/{Id:int?}"
@inject EmployeeService EmployeeService
@inject NavigationManager NavManager
@using rp_giprocomex.Core.Models

<h3>@(isNew ? "Nuevo empleado" : "Editar empleado")</h3>

<EditForm Model="employee" OnValidSubmit="Save">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-2">
        <label>Número</label>
        <InputNumber class="form-control" @bind-Value="employee.Numero" />
    </div>
    <div class="mb-2">
        <label>Puesto</label>
        <InputText class="form-control" @bind-Value="employee.Puesto" />
    </div>
    <div class="mb-2">
        <label>Oficina</label>
        <InputText class="form-control" @bind-Value="employee.Oficina" />
    </div>
    <div class="mb-2">
        <label>Nombre completo</label>
        <InputText class="form-control" @bind-Value="employee.NombreCompleto" />
    </div>
    <div class="mb-2">
        <label>Fecha ingreso</label>
        <InputDate class="form-control" @bind-Value="employee.FechaIngreso" />
    </div>
    <div class="form-check mb-2">
        <InputCheckbox class="form-check-input" @bind-Value="employee.Indeterminado" />
        <label class="form-check-label">Indeterminado</label>
    </div>

    <button class="btn btn-primary" type="submit">Guardar</button>
    <button class="btn btn-secondary" type="button" @onclick="Cancel">Cancelar</button>
</EditForm>

@code {
    [Parameter] public int? Id { get; set; }
    private Employee employee = new();
    private bool isNew = true;

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue)
        {
            var e = await EmployeeService.GetByIdAsync(Id.Value);
            if (e != null) { employee = e; isNew = false; }
        }
        else
        {
            // valores por defecto
            employee.FechaIngreso = DateTime.Today;
        }
    }

    private async Task Save()
    {
        if (isNew) await EmployeeService.AddAsync(employee);
        else await EmployeeService.UpdateAsync(employee);

        NavManager.NavigateTo("/employees");
    }

    private void Cancel() => NavManager.NavigateTo("/employees");
}